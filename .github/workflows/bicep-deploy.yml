---
name: Bicep-Template_Build
on:
  workflow_dispatch:
  push:
    branches:
    - main

env:
  resourceGroupName: Biceptesting
  resourceGroupLocation: norwayeast
  bicepfilePath: ./bicepfiles/main.bicep
  ENVIRONMENT_TYPE: Test


#################################################
#                                               #        
#################    DEPLOY   ###################
#                                               #
#################################################

  deploy: 
   environment: prod
   runs-on: ubuntu-latest
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: azure/login@v1
      name: Sign in to Azure
      with:
        creds: ${{secrets.AZURE_CREDENTIALS}}
        enable-AzPSSession: true
    - uses: azure/arm-deploy@v1
      name: Deploy website
      with:
        failOnStdErr: false
        deploymentName: ${{ github.run_number }}
        resourceGroupName: ${{ env.AZURE_RESOURCEGROUP_NAME }}
        template: ./bicepfiles/main.bicep
        parameters: environmentType=${{ env.ENVIRONMENT_TYPE }}