---
name: Bicep-Template_Build
on:
  workflow_dispatch:
  push:
    branches:
    - main

permissions:
  id-token: write
  contents: read

env:
  AZURE_RESOURCEGROUP_NAME: Biceptesting
  ENVIRONMENT_TYPE: Test

# Deploys the template

  deploy:
  runs-on: ubuntu-latest
  needs: [lint, validate]
  steps:
  - uses: actions/checkout@v3
  - uses: azure/login@v1
    name: Sign in to Azure
    with:
      creds: ${{secrets.AZURE_CREDENTIALS}}
      enable-AzPSSession: true 
  - uses: azure/arm-deploy@v1
    name: Deploy website
    with:
      failOnStdErr: false
      deploymentName: ${{ github.run_number }}
      resourceGroupName: ${{ env.AZURE_RESOURCEGROUP_NAME }}
      template: .bicepfiles/main.bicep
      parameters: environmentType=${{ env.ENVIRONMENT_TYPE }}